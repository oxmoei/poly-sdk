# Poly-SDK è®¾è®¡åæ€

> Date: 2025-12-26
> è§¦å‘åœºæ™¯: åˆ†æ simonbanza ($171K PnL) æ—¶å‘ç°åªèƒ½è·å–æœ€è¿‘ 100 æ¡äº¤æ˜“

---

## 1. æˆ‘ä»¬åˆ°åº•è¦ä»€ä¹ˆï¼Ÿ

### 1.1 ç”¨æˆ·åœºæ™¯åˆ†æ

å½“æˆ‘ä»¬è¯´"åˆ†æä¸€ä¸ª Smart Money äº¤æ˜“è€…"æ—¶ï¼Œç”¨æˆ·æœŸæœ›çš„æ˜¯ï¼š

```
ç”¨æˆ·æƒ³è¦çš„å®Œæ•´åˆ†æ
â”œâ”€â”€ äº¤æ˜“è€…ç”»åƒ
â”‚   â”œâ”€â”€ æ€» PnLï¼ˆå†å²æ‰€æœ‰ï¼‰
â”‚   â”œâ”€â”€ èƒœç‡ã€é£æ ¼ï¼ˆè¶‹åŠ¿ã€å¥—åˆ©ã€äº‹ä»¶é©±åŠ¨ï¼‰
â”‚   â””â”€â”€ æ´»è·ƒå‘¨æœŸï¼ˆæ¯å¤©ï¼Ÿæ¯å‘¨ï¼Ÿï¼‰
â”‚
â”œâ”€â”€ å†å²äº¤æ˜“
â”‚   â”œâ”€â”€ ä»å¼€å§‹åˆ°ç°åœ¨çš„å®Œæ•´äº¤æ˜“è®°å½•
â”‚   â”œâ”€â”€ æŒ‰æ—¶é—´æ®µç»Ÿè®¡ï¼ˆ1å¤©/1å‘¨/1æœˆ/allï¼‰
â”‚   â”œâ”€â”€ æŒ‰å¸‚åœºåˆ†ç»„ï¼ˆå“ªäº›å¸‚åœºèµšé’±ï¼Œå“ªäº›äºé’±ï¼‰
â”‚   â””â”€â”€ æ—¶é—´çº¿å¯è§†åŒ–
â”‚
â”œâ”€â”€ å½“å‰æŒä»“
â”‚   â”œâ”€â”€ ç°åœ¨æŒæœ‰ä»€ä¹ˆ
â”‚   â”œâ”€â”€ å»ºä»“æˆæœ¬ vs å½“å‰ä»·æ ¼
â”‚   â””â”€â”€ æœªå®ç°ç›ˆäº
â”‚
â””â”€â”€ å†å²ç›ˆäº
    â”œâ”€â”€ PnL æ›²çº¿ï¼ˆé€æ—¥/é€å‘¨ï¼‰
    â”œâ”€â”€ å·²ç»“ç®—å¸‚åœºçš„ç›ˆäº
    â””â”€â”€ æœ€å¤§å›æ’¤ã€å¤æ™®æ¯”ç‡ç­‰
```

### 1.2 æˆ‘ä»¬å®é™…èƒ½åšåˆ°çš„

```
æˆ‘ä»¬ç›®å‰èƒ½åšçš„
â”œâ”€â”€ äº¤æ˜“è€…ç”»åƒ
â”‚   â”œâ”€â”€ æ€» PnL âœ… (ä» Leaderboard è·å–)
â”‚   â”œâ”€â”€ èƒœç‡ âš ï¸ (åªèƒ½ä»å½“å‰æŒä»“è®¡ç®—ï¼Œä¸å‡†ç¡®)
â”‚   â””â”€â”€ æ´»è·ƒå‘¨æœŸ âŒ (åªæœ‰æœ€è¿‘ 100 æ¡)
â”‚
â”œâ”€â”€ å†å²äº¤æ˜“
â”‚   â”œâ”€â”€ å®Œæ•´è®°å½• âŒ åªæœ‰æœ€è¿‘ 100 æ¡
â”‚   â”œâ”€â”€ æ—¶é—´æ®µç»Ÿè®¡ âŒ ä¸æ”¯æŒ start/end
â”‚   â”œâ”€â”€ å¸‚åœºåˆ†ç»„ âš ï¸ åªæœ‰æœ€è¿‘ 100 æ¡çš„
â”‚   â””â”€â”€ æ—¶é—´çº¿ âŒ ä¸å®Œæ•´
â”‚
â”œâ”€â”€ å½“å‰æŒä»“
â”‚   â”œâ”€â”€ ç°åœ¨æŒæœ‰ä»€ä¹ˆ âœ…
â”‚   â”œâ”€â”€ å»ºä»“æˆæœ¬ âœ…
â”‚   â””â”€â”€ æœªå®ç°ç›ˆäº âœ…
â”‚
â””â”€â”€ å†å²ç›ˆäº
    â”œâ”€â”€ PnL æ›²çº¿ âŒ Data API ä¸æä¾›
    â”œâ”€â”€ å·²ç»“ç®—ç›ˆäº âŒ Data API ä¸æä¾›
    â””â”€â”€ é£é™©æŒ‡æ ‡ âŒ æ— å†å²æ•°æ®
```

### 1.3 å·®è·æ€»ç»“

| èƒ½åŠ› | æœŸæœ› | ç°å® | å·®è·åŸå›  |
|------|------|------|----------|
| äº¤æ˜“å†å² | å…¨éƒ¨ | 100 æ¡ | ç¼º offset/start/end |
| æ—¶é—´è¿‡æ»¤ | æ”¯æŒ | ä¸æ”¯æŒ | ç¼º start/end å‚æ•° |
| å†å² PnL | æ—¶é—´åºåˆ— | åªæœ‰å½“å‰ | Data API ä¸æä¾›ï¼Œéœ€ Subgraph |
| å·²ç»“ç®—ç›ˆäº | è¯¦ç»†è®°å½• | åªæœ‰æ±‡æ€» | åŒä¸Š |

---

## 2. ä¸ºä»€ä¹ˆä¹‹å‰æ²¡å‘ç°è¿™äº›é—®é¢˜ï¼Ÿ

### 2.1 éœ€æ±‚é©±åŠ¨ vs èƒ½åŠ›é©±åŠ¨

```
æˆ‘ä»¬çš„å¼€å‘æ¨¡å¼ï¼ˆé”™è¯¯çš„ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·éœ€æ±‚: "å¸®æˆ‘çœ‹çœ‹è¿™ä¸ªäº¤æ˜“è€…"                                  â”‚
â”‚       â†“                                                          â”‚
â”‚  å¼€å‘æ€è·¯: "è°ƒç”¨ APIï¼Œèƒ½è¿”å›ä»€ä¹ˆå°±å±•ç¤ºä»€ä¹ˆ"                       â”‚
â”‚       â†“                                                          â”‚
â”‚  ç»“æœ: getPositions() + getActivity(limit=100)                  â”‚
â”‚       â†“                                                          â”‚
â”‚  é—®é¢˜: "èƒ½å·¥ä½œ" â‰  "æ»¡è¶³éœ€æ±‚"                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åº”è¯¥çš„å¼€å‘æ¨¡å¼ï¼ˆæ­£ç¡®çš„ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·éœ€æ±‚: "å¸®æˆ‘çœ‹çœ‹è¿™ä¸ªäº¤æ˜“è€…"                                  â”‚
â”‚       â†“                                                          â”‚
â”‚  éœ€æ±‚åˆ†æ: ç”¨æˆ·æƒ³çœ‹ä»€ä¹ˆï¼Ÿå†å²å¤šé•¿ï¼Ÿéœ€è¦å“ªäº›ç»´åº¦ï¼Ÿ                â”‚
â”‚       â†“                                                          â”‚
â”‚  API è°ƒç ”: Polymarket èƒ½æä¾›ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›å‚æ•°ï¼Ÿ                  â”‚
â”‚       â†“                                                          â”‚
â”‚  å·®è·åˆ†æ: èƒ½åŠ› vs éœ€æ±‚ï¼Œå“ªäº›èƒ½åšï¼Œå“ªäº›ä¸èƒ½ï¼Ÿ                    â”‚
â”‚       â†“                                                          â”‚
â”‚  è®¾è®¡å†³ç­–: å¦‚ä½•æœ€å¤§åŒ–åˆ©ç”¨ API èƒ½åŠ›ï¼Ÿ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 API æ–‡æ¡£ç ”ç©¶ä¸è¶³

æˆ‘ä»¬åªçœ‹äº†ï¼š
```typescript
// æˆ‘ä»¬ä»¥ä¸ºçš„ API
GET /activity?user=0x...&limit=100
```

æˆ‘ä»¬æ²¡çœ‹åˆ°çš„ï¼š
```typescript
// API å®é™…æ”¯æŒçš„å®Œæ•´å‚æ•°
GET /activity
  ?user=0x...        // å¿…å¡«
  &limit=500         // æœ€å¤§ 500ï¼Œæˆ‘ä»¬åªç”¨ 100
  &offset=0          // åˆ†é¡µï¼å¯ä»¥è·å–æ›´å¤š
  &start=1734000000  // å¼€å§‹æ—¶é—´æˆ³
  &end=1734999999    // ç»“æŸæ—¶é—´æˆ³
  &type=TRADE        // æˆ‘ä»¬çŸ¥é“
  &side=BUY          // æˆ‘ä»¬çŸ¥é“
  &market=0x...      // æŒ‰å¸‚åœºè¿‡æ»¤
  &sortBy=TIMESTAMP  // æ’åºå­—æ®µ
  &sortDirection=ASC // æ’åºæ–¹å‘
```

### 2.3 ä»¥"å¸‚åœº"ä¸ºä¸­å¿ƒçš„è®¾è®¡åè§

çœ‹æˆ‘ä»¬çš„ä»£ç ç»“æ„å°±çŸ¥é“æˆ‘ä»¬çš„å…³æ³¨ç‚¹ï¼š

```
packages/poly-sdk/src/
â”œâ”€â”€ core/types.ts           # 90% æ˜¯å¸‚åœºç›¸å…³ç±»å‹
â”‚   â”œâ”€â”€ UnifiedMarket       # âœ… è¯¦ç»†å®šä¹‰
â”‚   â”œâ”€â”€ ProcessedOrderbook  # âœ… è¯¦ç»†å®šä¹‰
â”‚   â”œâ”€â”€ ArbitrageOpportunity # âœ… è¯¦ç»†å®šä¹‰
â”‚   â””â”€â”€ äº¤æ˜“è€…ç›¸å…³ç±»å‹       # âŒ æ²¡æœ‰ï¼
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ market-service.ts   # 200+ è¡Œï¼ŒåŠŸèƒ½ä¸°å¯Œ
â”‚   â”œâ”€â”€ wallet-service.ts   # 150 è¡Œï¼Œåªæ˜¯è–„å°è£…
â”‚   â””â”€â”€ arbitrage-service.ts # 500+ è¡Œï¼ŒåŠŸèƒ½ä¸°å¯Œ
â”‚
â””â”€â”€ clients/
    â”œâ”€â”€ gamma-api.ts        # å¸‚åœºå‘ç°ï¼ŒåŠŸèƒ½å®Œæ•´
    â”œâ”€â”€ clob-api.ts         # è®¢å•ç°¿ï¼ŒåŠŸèƒ½å®Œæ•´
    â””â”€â”€ data-api.ts         # äº¤æ˜“è€…æ•°æ®ï¼Œåªå®ç°äº†åŸºç¡€åŠŸèƒ½
```

**é—®é¢˜æ ¹æº**ï¼šæˆ‘ä»¬å‡è®¾ç”¨æˆ·ä¸»è¦å…³å¿ƒ"å¸‚åœº"ï¼Œè€Œ"äº¤æ˜“è€…"åªæ˜¯é™„å±ã€‚

ä½†å®é™…ä¸Šï¼ŒSmart Money åˆ†æåœºæ™¯ä¸­ï¼Œ**äº¤æ˜“è€…æ‰æ˜¯æ ¸å¿ƒ**ã€‚

### 2.4 æ²¡æœ‰åš"è¾¹ç•Œæµ‹è¯•"

æˆ‘ä»¬æµ‹è¯•æ—¶ç”¨çš„åœºæ™¯ï¼š
```
- è·å–ä¸€ä¸ªäº¤æ˜“è€…çš„æŒä»“ â†’ æˆåŠŸ
- è·å–ä¸€ä¸ªäº¤æ˜“è€…çš„æœ€è¿‘äº¤æ˜“ â†’ æˆåŠŸ
â†’ ç»“è®ºï¼šåŠŸèƒ½å®Œæˆ
```

æˆ‘ä»¬æ²¡æœ‰æµ‹è¯•çš„åœºæ™¯ï¼š
```
- è·å–ä¸€ä¸ªæ´»è·ƒäº¤æ˜“è€…çš„å…¨éƒ¨äº¤æ˜“å†å² â†’ å¤±è´¥ï¼ˆåªæœ‰ 100 æ¡ï¼‰
- æŒ‰æ—¶é—´æ®µç­›é€‰äº¤æ˜“ â†’ å¤±è´¥ï¼ˆä¸æ”¯æŒï¼‰
- è·å–å†å² PnL æ›²çº¿ â†’ å¤±è´¥ï¼ˆä¸æ”¯æŒï¼‰
```

---

## 3. API å®é™…è¿”å› vs æˆ‘ä»¬çš„ç±»å‹å®šä¹‰

### 3.1 Activity ç«¯ç‚¹

**API å®é™…è¿”å›**ï¼ˆä» Data API æ–‡æ¡£å’Œå®é™…è°ƒç”¨ï¼‰ï¼š

```json
{
  "type": "TRADE",
  "side": "BUY",
  "size": 22.47,
  "price": 0.11,
  "usdcSize": 2.47,
  "asset": "71321045683....",          // tokenId
  "conditionId": "0x946cb298...",
  "outcome": "Chiefs",
  "outcomeIndex": 1,
  "timestamp": 1735146579,             // Unix ç§’
  "transactionHash": "0x26ff75e2...",
  "title": "Broncos vs. Chiefs",
  "slug": "nfl-den-kc-2025-12-25",
  "name": "simonbanza",                // äº¤æ˜“è€…åç§°
  "proxyWallet": "0x5350afcd..."       // æœ‰æ—¶è¿”å›
}
```

**æˆ‘ä»¬çš„ç±»å‹**ï¼ˆdata-api.tsï¼‰ï¼š

```typescript
export interface Activity {
  type: 'TRADE' | 'SPLIT' | 'MERGE' | 'REDEEM' | 'CONVERSION';
  side: 'BUY' | 'SELL';
  size: number;
  price: number;
  usdcSize?: number;
  asset: string;
  conditionId: string;
  outcome: string;
  outcomeIndex?: number;
  timestamp: number;
  transactionHash: string;
  title?: string;
  slug?: string;
  name?: string;
}
```

**è¯„ä¼°**ï¼šç±»å‹å®šä¹‰åŸºæœ¬æ­£ç¡®ï¼Œä½†ç¼ºå°‘æŸ¥è¯¢å‚æ•°æ”¯æŒã€‚

### 3.2 Positions ç«¯ç‚¹

**API å®é™…è¿”å›**ï¼š

```json
{
  "proxyWallet": "0x5350afcd...",
  "asset": "71321045683...",
  "conditionId": "0xb00dcbf2...",
  "outcome": "Vikings",
  "outcomeIndex": 1,
  "size": 124999.83,
  "avgPrice": 0.23,
  "curPrice": 0.235,
  "totalBought": 124999.83,
  "initialValue": 28749.96,
  "currentValue": 29374.96,
  "cashPnl": 624.99,
  "percentPnl": 2.17,
  "realizedPnl": 0,
  "percentRealizedPnl": 0,
  "title": "Lions vs. Vikings",
  "slug": "nfl-det-min-2025-12-25",
  "icon": "https://...",
  "eventId": "12345",
  "eventSlug": "nfl-week-17",
  "oppositeOutcome": "Lions",
  "oppositeAsset": "...",
  "redeemable": false,
  "mergeable": false,
  "endDate": "2025-12-25T23:59:59Z",
  "negativeRisk": false
}
```

**æˆ‘ä»¬çš„ç±»å‹**ï¼šâœ… å®Œæ•´è¦†ç›–

**é—®é¢˜**ï¼šç±»å‹æ­£ç¡®ï¼Œä½† `getPositions()` æ–¹æ³•ä¸æ”¯æŒä»»ä½•å‚æ•°ï¼š

```typescript
// ç°çŠ¶
async getPositions(address: string): Promise<Position[]>

// åº”è¯¥æ˜¯
async getPositions(address: string, params?: {
  limit?: number;
  offset?: number;
  market?: string[];
  sizeThreshold?: number;
  redeemable?: boolean;
  sortBy?: 'CASHPNL' | 'PERCENTPNL' | 'TOKENS' | ...;
  sortDirection?: 'ASC' | 'DESC';
}): Promise<Position[]>
```

### 3.3 Leaderboard ç«¯ç‚¹

**API å®é™…è¿”å›**ï¼š

```json
{
  "proxyWallet": "0x5350afcd...",
  "rank": 1,
  "pnl": 171604.40,
  "vol": 282691.55,           // æ³¨æ„æ˜¯ "vol" ä¸æ˜¯ "volume"
  "userName": "simonbanza",
  "xUsername": null,
  "verifiedBadge": false,
  "profileImage": null,
  "positions": null,          // ç»å¸¸æ˜¯ null
  "trades": null              // ç»å¸¸æ˜¯ null
}
```

**æˆ‘ä»¬çš„ç±»å‹**ï¼šâœ… åŸºæœ¬æ­£ç¡®ï¼Œå·²å¤„ç† `vol` â†’ `volume` çš„è½¬æ¢

---

## 4. æ ¸å¿ƒæ¶æ„é—®é¢˜

### 4.1 å½“å‰æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PolymarketSDK                                â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    API Clients (åº•å±‚)                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ GammaApi    â”‚ â”‚ ClobApi     â”‚ â”‚ DataApi             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ (å¸‚åœºå‘ç°)   â”‚ â”‚ (è®¢å•ç°¿)    â”‚ â”‚ (ç”¨æˆ·æ•°æ®)           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ âœ… åŠŸèƒ½å®Œæ•´  â”‚ â”‚ âœ… åŠŸèƒ½å®Œæ•´  â”‚ â”‚ âš ï¸ åªå®ç°äº†åŸºç¡€     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Services (é«˜å±‚)                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ MarketSvc   â”‚ â”‚ ArbService  â”‚ â”‚ WalletService       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ Kçº¿/ä»·æ ¼    â”‚ â”‚ å¥—åˆ©æ£€æµ‹     â”‚ â”‚ äº¤æ˜“è€…åˆ†æ           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ âœ… 200è¡Œ    â”‚ â”‚ âœ… 500è¡Œ    â”‚ â”‚ âš ï¸ 150è¡Œï¼Œè–„å°è£…    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 é—®é¢˜

1. **DataApi åŠŸèƒ½ä¸å®Œæ•´**
   - åªæš´éœ²äº† API çš„åŸºç¡€èƒ½åŠ›
   - ç¼ºå°‘æ—¶é—´è¿‡æ»¤ã€åˆ†é¡µã€æ’åº

2. **WalletService æ²¡æœ‰å¢å€¼**
   - åªæ˜¯ DataApi çš„è–„å°è£…
   - æ²¡æœ‰å®ç°é«˜çº§åˆ†æåŠŸèƒ½
   - æ²¡æœ‰æ•°æ®èšåˆã€å†å²é‡å»ºèƒ½åŠ›

3. **ç¼ºå°‘ TraderAnalytics å±‚**
   - æ²¡æœ‰ä¸“é—¨çš„äº¤æ˜“è€…åˆ†ææœåŠ¡
   - æ²¡æœ‰å†å²æ•°æ®é‡å»ºèƒ½åŠ›
   - æ²¡æœ‰ PnL æ›²çº¿è®¡ç®—

### 4.3 åº”è¯¥çš„æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PolymarketSDK                                â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    API Clients (å®Œæ•´å‚æ•°æ”¯æŒ)               â”‚  â”‚
â”‚  â”‚  DataApiClient.getActivity(address, {                       â”‚  â”‚
â”‚  â”‚    limit: 500,                                              â”‚  â”‚
â”‚  â”‚    offset: 0,                                               â”‚  â”‚
â”‚  â”‚    start: 1733961600,  // 2024-12-12                        â”‚  â”‚
â”‚  â”‚    end: Date.now(),                                         â”‚  â”‚
â”‚  â”‚    sortBy: 'TIMESTAMP',                                     â”‚  â”‚
â”‚  â”‚    sortDirection: 'ASC'                                     â”‚  â”‚
â”‚  â”‚  })                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Services (é«˜å±‚åˆ†æ)                       â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  TraderAnalyticsService (æ–°å¢)                               â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ getAllTradeHistory(address)  // è‡ªåŠ¨åˆ†é¡µè·å–å…¨éƒ¨        â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ getTradesByPeriod(address, '1w')  // æŒ‰æ—¶é—´æ®µ          â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ getMarketPnL(address, conditionId)  // æŒ‰å¸‚åœºç»Ÿè®¡      â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ buildPnLTimeline(address)  // æ„å»º PnL æ›²çº¿            â”‚  â”‚
â”‚  â”‚  â””â”€â”€ analyzeStrategy(address)  // ç­–ç•¥é£æ ¼åˆ†æ              â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  HistoricalDataService (æ–°å¢ï¼Œéœ€è¦ Subgraph)                 â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ getSettledPositions(address)  // å·²ç»“ç®—ä»“ä½            â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ getPnLHistory(address)  // å†å² PnL å¿«ç…§               â”‚  â”‚
â”‚  â”‚  â””â”€â”€ getPositionHistory(address, conditionId)               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. æ•°æ®ç»“æ„é‡æ–°è®¾è®¡

### 5.1 æŸ¥è¯¢å‚æ•°ç±»å‹ï¼ˆæ–°å¢ï¼‰

```typescript
/**
 * Activity æŸ¥è¯¢å‚æ•°
 * å®Œæ•´æ”¯æŒ Polymarket Data API çš„æ‰€æœ‰å‚æ•°
 */
export interface ActivityQueryParams {
  // åˆ†é¡µ
  limit?: number;          // 1-500, é»˜è®¤ 100
  offset?: number;         // 0-10000, ç”¨äºåˆ†é¡µ

  // æ—¶é—´è¿‡æ»¤
  start?: number;          // Unix æ—¶é—´æˆ³ (ç§’)
  end?: number;            // Unix æ—¶é—´æˆ³ (ç§’)

  // ç±»å‹è¿‡æ»¤
  type?: ActivityType | ActivityType[];
  side?: 'BUY' | 'SELL';

  // å¸‚åœºè¿‡æ»¤
  market?: string[];       // conditionIds
  eventId?: number[];

  // æ’åº
  sortBy?: 'TIMESTAMP' | 'TOKENS' | 'CASH';
  sortDirection?: 'ASC' | 'DESC';
}

/**
 * Positions æŸ¥è¯¢å‚æ•°
 */
export interface PositionsQueryParams {
  // åˆ†é¡µ
  limit?: number;          // 1-500
  offset?: number;         // 0-10000

  // è¿‡æ»¤
  market?: string[];       // conditionIds
  eventId?: number[];
  sizeThreshold?: number;  // æœ€å°ä»“ä½
  redeemable?: boolean;
  mergeable?: boolean;
  title?: string;          // æ ‡é¢˜æœç´¢

  // æ’åº
  sortBy?:
    | 'CURRENT'      // å½“å‰ä»·å€¼
    | 'INITIAL'      // åˆå§‹ä»·å€¼
    | 'TOKENS'       // ä»£å¸æ•°é‡
    | 'CASHPNL'      // ç°é‡‘ PnL
    | 'PERCENTPNL'   // ç™¾åˆ†æ¯” PnL
    | 'TITLE'        // æ ‡é¢˜
    | 'RESOLVING'    // å³å°†ç»“ç®—
    | 'PRICE'        // å½“å‰ä»·æ ¼
    | 'AVGPRICE';    // å¹³å‡æˆæœ¬
  sortDirection?: 'ASC' | 'DESC';
}
```

### 5.2 æ—¶é—´æ®µè¾…åŠ©ç±»å‹ï¼ˆæ–°å¢ï¼‰

```typescript
/**
 * é¢„è®¾æ—¶é—´æ®µ
 */
export type TimePeriod = '1d' | '1w' | '1m' | '3m' | 'all';

/**
 * æ—¶é—´èŒƒå›´
 */
export interface TimeRange {
  start: number;  // Unix æ—¶é—´æˆ³ (ç§’)
  end: number;    // Unix æ—¶é—´æˆ³ (ç§’)
}

/**
 * å°†æ—¶é—´æ®µè½¬æ¢ä¸ºæ—¶é—´èŒƒå›´
 */
export function periodToRange(period: TimePeriod): TimeRange {
  const end = Math.floor(Date.now() / 1000);
  const day = 24 * 60 * 60;

  switch (period) {
    case '1d': return { start: end - day, end };
    case '1w': return { start: end - 7 * day, end };
    case '1m': return { start: end - 30 * day, end };
    case '3m': return { start: end - 90 * day, end };
    case 'all': return { start: 0, end };
  }
}
```

### 5.3 äº¤æ˜“è€…åˆ†æç±»å‹ï¼ˆæ–°å¢ï¼‰

```typescript
/**
 * å®Œæ•´äº¤æ˜“å†å²
 */
export interface TradeHistory {
  trader: {
    address: string;
    displayName?: string;
  };

  // å®Œæ•´äº¤æ˜“åˆ—è¡¨
  trades: Activity[];

  // ç»Ÿè®¡
  summary: {
    totalTrades: number;
    buyCount: number;
    sellCount: number;
    buyVolume: number;    // USDC
    sellVolume: number;   // USDC

    // æŒ‰å¸‚åœºåˆ†ç»„
    marketBreakdown: Map<string, {
      conditionId: string;
      title: string;
      tradeCount: number;
      buyVolume: number;
      sellVolume: number;
      netPosition: number;
    }>;

    // æŒ‰æ—¶é—´åˆ†ç»„
    dailyVolume: Array<{
      date: string;  // YYYY-MM-DD
      buyVolume: number;
      sellVolume: number;
      tradeCount: number;
    }>;
  };

  // æŸ¥è¯¢å…ƒæ•°æ®
  query: {
    period?: TimePeriod;
    timeRange?: TimeRange;
    totalPages: number;
    isTruncated: boolean;  // æ˜¯å¦è¶…è¿‡ 10000 æ¡é™åˆ¶
  };
}

/**
 * ç­–ç•¥åˆ†æ
 */
export interface StrategyAnalysis {
  trader: {
    address: string;
    displayName?: string;
  };

  // äº¤æ˜“é£æ ¼
  style: {
    primary: 'holder' | 'trader' | 'arbitrageur' | 'market_maker';
    characteristics: string[];
  };

  // åå¥½
  preferences: {
    avgHoldingPeriod: number;    // ç§’
    preferredMarkets: string[];   // ç±»åˆ«ï¼šsports, politics, crypto
    avgPositionSize: number;      // USDC
    riskLevel: 'conservative' | 'moderate' | 'aggressive';
  };

  // è¡¨ç°
  performance: {
    winRate: number;
    avgWinSize: number;
    avgLossSize: number;
    profitFactor: number;        // æ€»ç›ˆåˆ© / æ€»äºæŸ
    sharpeRatio?: number;        // å¦‚æœæœ‰å†å²æ•°æ®
    maxDrawdown?: number;
  };

  // æ—¶é—´æ¨¡å¼
  timing: {
    mostActiveHours: number[];   // 0-23
    mostActiveDays: number[];    // 0-6 (å‘¨æ—¥-å‘¨å…­)
    avgTradesPerDay: number;
  };
}
```

### 5.4 å†å² PnL ç±»å‹ï¼ˆéœ€è¦ Subgraphï¼‰

```typescript
/**
 * PnL å¿«ç…§
 * æ¥æº: Goldsky PnL Subgraph
 */
export interface PnLSnapshot {
  timestamp: number;
  realizedPnl: number;
  unrealizedPnl: number;
  totalPnl: number;
  positionCount: number;
}

/**
 * PnL å†å²
 */
export interface PnLHistory {
  trader: {
    address: string;
    displayName?: string;
  };

  // æ—¶é—´åºåˆ—
  snapshots: PnLSnapshot[];

  // æ±‡æ€»
  summary: {
    startPnl: number;
    endPnl: number;
    change: number;
    changePercent: number;
    maxPnl: number;
    minPnl: number;
    maxDrawdown: number;
    maxDrawdownPercent: number;
  };

  // æ•°æ®æ¥æº
  source: 'data_api' | 'subgraph';
}

/**
 * å·²ç»“ç®—ä»“ä½
 * æ¥æº: Goldsky Positions Subgraph
 */
export interface SettledPosition {
  conditionId: string;
  title: string;
  outcome: string;

  // å…¥åœº
  entrySize: number;
  entryAvgPrice: number;
  entryTimestamp: number;

  // ç»“ç®—
  settlementOutcome: 'won' | 'lost';
  settlementPrice: number;     // 1.0 æˆ– 0.0
  settlementTimestamp: number;

  // ç›ˆäº
  realizedPnl: number;
  percentPnl: number;
}
```

---

## 6. å®ç°è·¯çº¿å›¾

### Phase 1: Data API å¢å¼º (P0)

**ç›®æ ‡**: å®Œæ•´æ”¯æŒ Activity å’Œ Positions çš„æŸ¥è¯¢å‚æ•°

```typescript
// 1. å¢å¼º ActivityParams
// æ–‡ä»¶: packages/poly-sdk/src/clients/data-api.ts

async getActivity(
  address: string,
  params?: ActivityQueryParams
): Promise<Activity[]>

// 2. å¢å¼º PositionsParams
async getPositions(
  address: string,
  params?: PositionsQueryParams
): Promise<Position[]>

// 3. æ·»åŠ è¾…åŠ©æ–¹æ³•
async getAllActivity(
  address: string,
  params?: Omit<ActivityQueryParams, 'offset'>
): Promise<Activity[]>
// è‡ªåŠ¨åˆ†é¡µï¼Œè·å–å…¨éƒ¨æ•°æ®ï¼ˆæœ€å¤š 10000 æ¡ï¼‰

async getActivityByPeriod(
  address: string,
  period: TimePeriod
): Promise<Activity[]>
// æŒ‰é¢„è®¾æ—¶é—´æ®µè·å–
```

**é¢„è®¡å·¥ä½œé‡**: 0.5 å¤©

### Phase 2: TraderAnalyticsService (P1)

**ç›®æ ‡**: é«˜çº§äº¤æ˜“è€…åˆ†æèƒ½åŠ›

```typescript
// æ–‡ä»¶: packages/poly-sdk/src/services/trader-analytics.ts

class TraderAnalyticsService {
  // è·å–å®Œæ•´äº¤æ˜“å†å²
  async getTradeHistory(
    address: string,
    period?: TimePeriod
  ): Promise<TradeHistory>

  // åˆ†æäº¤æ˜“ç­–ç•¥
  async analyzeStrategy(
    address: string
  ): Promise<StrategyAnalysis>

  // æŒ‰å¸‚åœºç»Ÿè®¡ PnL
  async getMarketPnL(
    address: string,
    conditionId: string
  ): Promise<MarketPnL>

  // æ„å»º PnL æ—¶é—´çº¿ï¼ˆåŸºäºäº¤æ˜“é‡å»ºï¼‰
  async buildPnLTimeline(
    address: string,
    interval: '1h' | '1d' | '1w'
  ): Promise<PnLSnapshot[]>
}
```

**é¢„è®¡å·¥ä½œé‡**: 1 å¤©

### Phase 3: MCP å·¥å…·å¢å¼º (P1)

**ç›®æ ‡**: æš´éœ²æ–°èƒ½åŠ›ç»™ Claude

```typescript
// å¢å¼º get_trader_trades
{
  name: 'get_trader_trades',
  inputSchema: {
    properties: {
      address: { type: 'string' },
      period: { enum: ['1d', '1w', '1m', '3m', 'all'] },  // æ–°å¢
      startDate: { type: 'string' },                       // æ–°å¢
      endDate: { type: 'string' },                         // æ–°å¢
      market: { type: 'string' },                          // æ–°å¢
      limit: { type: 'number' },
      side: { enum: ['BUY', 'SELL'] }
    }
  }
}

// æ–°å¢ get_trader_history
{
  name: 'get_trader_history',
  description: 'è·å–äº¤æ˜“è€…å®Œæ•´å†å² (è‡ªåŠ¨åˆ†é¡µ)',
  inputSchema: {
    properties: {
      address: { type: 'string' },
      period: { enum: ['1d', '1w', '1m', '3m', 'all'] }
    }
  }
}

// æ–°å¢ analyze_trader_strategy
{
  name: 'analyze_trader_strategy',
  description: 'åˆ†æäº¤æ˜“è€…ç­–ç•¥é£æ ¼',
  inputSchema: {
    properties: {
      address: { type: 'string' }
    }
  }
}
```

**é¢„è®¡å·¥ä½œé‡**: 0.5 å¤©

### Phase 4: Subgraph é›†æˆ (P2)

**ç›®æ ‡**: å†å² PnL å’Œå·²ç»“ç®—ä»“ä½

```typescript
// æ–‡ä»¶: packages/poly-sdk/src/clients/goldsky-client.ts

class GoldskyClient {
  // PnL Subgraph
  async getPnLHistory(
    address: string,
    since?: number
  ): Promise<PnLSnapshot[]>

  // Positions Subgraph
  async getSettledPositions(
    address: string
  ): Promise<SettledPosition[]>

  async getPositionHistory(
    address: string,
    conditionId: string
  ): Promise<PositionSnapshot[]>
}
```

**é¢„è®¡å·¥ä½œé‡**: 2-3 å¤©

---

## 7. æ€»ç»“

### 7.1 æ ¹æœ¬é—®é¢˜

1. **éœ€æ±‚åˆ†æä¸è¶³** - æ²¡æœ‰ä»ç”¨æˆ·åœºæ™¯å‡ºå‘è®¾è®¡
2. **API ç ”ç©¶ä¸æ·±** - åªç”¨äº†åŸºç¡€åŠŸèƒ½ï¼Œå¿½ç•¥äº†é«˜çº§å‚æ•°
3. **æ¶æ„åè§** - ä»¥å¸‚åœºä¸ºä¸­å¿ƒï¼Œå¿½è§†äº¤æ˜“è€…åˆ†æ

### 7.2 ä¿®å¤ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | ä»»åŠ¡ | å½±å“ | å·¥ä½œé‡ |
|--------|------|------|--------|
| **P0** | Activity/Positions å‚æ•°å¢å¼º | è·å–å®Œæ•´å†å² | 0.5 å¤© |
| **P1** | TraderAnalyticsService | é«˜çº§åˆ†æèƒ½åŠ› | 1 å¤© |
| **P1** | MCP å·¥å…·å¢å¼º | æš´éœ²èƒ½åŠ›ç»™ Claude | 0.5 å¤© |
| **P2** | Subgraph é›†æˆ | å†å² PnL | 2-3 å¤© |

### 7.3 æ•™è®­

1. **å…ˆç†è§£ API èƒ½åŠ›ï¼Œå†è®¾è®¡æ¥å£**
2. **ä»ç”¨æˆ·åœºæ™¯å‡ºå‘ï¼Œä¸æ˜¯ä»æŠ€æœ¯èƒ½åŠ›å‡ºå‘**
3. **è¾¹ç•Œæµ‹è¯•**ï¼šä¸åªæµ‹è¯•"èƒ½å·¥ä½œ"ï¼Œè¿˜è¦æµ‹è¯•"æé™æƒ…å†µ"
4. **æ–‡æ¡£å®Œæ•´é˜…è¯»**ï¼šä¸è¦åªçœ‹ exampleï¼Œè¦çœ‹å®Œæ•´ API å‚è€ƒ

---

## é™„å½• A: Multi-Agent Review ç»“æœ

> Review Date: 2025-12-26
> å…± 3 ä¸ª Agent ä»ä¸åŒè§’åº¦è¿›è¡Œäº†å®¡æŸ¥

### A.1 API å‚æ•°å®Œæ•´æ€§ Review

| ç«¯ç‚¹ | è¦†ç›–ç‡ | çŠ¶æ€ |
|------|--------|------|
| Activity | 11/11 | âœ… å®Œæ•´ |
| Positions | 11/11 | âœ… å®Œæ•´ |
| **Trades** | **0/7** | âŒ **å®Œå…¨ç¼ºå¤±** |
| Value | 0/1 | âŒ æœªè¦†ç›– |
| Holders | 0/1 | âŒ æœªè¦†ç›– |

#### é—æ¼é¡¹ç›®

**1. TradesQueryParams ç±»å‹å®Œå…¨ç¼ºå¤±**

```typescript
// éœ€è¦æ–°å¢
export interface TradesQueryParams {
  user?: string;                    // æŒ‰ç”¨æˆ·è¿‡æ»¤
  market?: string;                  // æŒ‰å¸‚åœºè¿‡æ»¤ (conditionId)
  limit?: number;                   // 1-500
  takerOnly?: boolean;              // åªè¿”å› taker äº¤æ˜“
  filterType?: 'CASH' | 'TOKENS';   // è¿‡æ»¤ç±»å‹
  filterAmount?: number;            // é‡‘é¢é˜ˆå€¼
  side?: 'BUY' | 'SELL';            // ä¹°å–æ–¹å‘
}
```

**2. Value ç«¯ç‚¹ç¼ºå¤±**

```typescript
// éœ€è¦æ–°å¢
export interface ValueQueryParams {
  user: string;           // é’±åŒ…åœ°å€ (å¿…å¡«)
  market?: string[];      // å¯é€‰ï¼ŒæŒ‡å®šå¸‚åœº
}
```

**3. Holders ç«¯ç‚¹ç¼ºå¤±**

```typescript
// éœ€è¦æ–°å¢
export interface HoldersQueryParams {
  market: string;         // conditionId (å¿…å¡«)
  limit?: number;         // è¿”å›æ•°é‡
}
```

**4. ActivityType ç¼ºå°‘ REWARD**

```typescript
// å½“å‰
'TRADE' | 'SPLIT' | 'MERGE' | 'REDEEM' | 'CONVERSION'

// åº”è¯¥æ˜¯
'TRADE' | 'SPLIT' | 'MERGE' | 'REDEEM' | 'REWARD' | 'CONVERSION'
```

---

### A.2 æ•°æ®ç»“æ„è®¾è®¡ Review

#### å‘ç°çš„é—®é¢˜

| é—®é¢˜ | ä¸¥é‡æ€§ | æè¿° |
|------|--------|------|
| æ—¶é—´æˆ³å•ä½ä¸ä¸€è‡´ | ğŸ”´ é«˜ | API å‚æ•°ç”¨ç§’ï¼Œå†…éƒ¨ normalize ç”¨æ¯«ç§’ |
| Map ä¸èƒ½ JSON åºåˆ—åŒ– | ğŸŸ¡ ä¸­ | `marketBreakdown: Map<...>` éœ€æ”¹ä¸º `Record<...>` |
| ç¼ºå°‘ proxyWallet | ğŸŸ¡ ä¸­ | TraderIdentity éœ€è¦åŒ…å« proxyWallet |
| SettledPosition ç¼ºå°‘ address | ğŸŸ¡ ä¸­ | éœ€è¦çŸ¥é“å±äºå“ªä¸ªäº¤æ˜“è€… |

#### å»ºè®®ä¿®æ”¹

**1. æ ‡å‡†åŒ–æ—¶é—´æˆ³ç±»å‹**

```typescript
/** Unix æ—¶é—´æˆ³ (ç§’) - åŒ¹é… Polymarket API */
export type UnixSeconds = number;

/** Unix æ—¶é—´æˆ³ (æ¯«ç§’) - SDK å†…éƒ¨è¡¨ç¤º */
export type UnixMillis = number;

export interface ActivityQueryParams {
  start?: UnixSeconds;  // æ˜ç¡®æ ‡æ³¨
  end?: UnixSeconds;
}
```

**2. ä½¿ç”¨ Record æ›¿ä»£ Map**

```typescript
// ä¿®æ”¹å‰
marketBreakdown: Map<string, MarketBreakdown>;

// ä¿®æ”¹å
marketBreakdown: Record<string, MarketBreakdown>;  // conditionId -> breakdown
```

**3. æ‰©å±• TraderIdentity**

```typescript
export interface TraderIdentity {
  address: string;           // ä¸»é’±åŒ…åœ°å€
  proxyWallet?: string;      // Polymarket ä»£ç†é’±åŒ…
  displayName?: string;
  userName?: string;
}
```

---

### A.3 å®ç°è·¯çº¿å›¾ Review

#### æ—¶é—´ä¼°ç®—å¯¹æ¯”

| Phase | åŸä¼°ç®— | ä¿®æ­£ä¼°ç®— | åŸå›  |
|-------|--------|----------|------|
| Phase 1 | 0.5 å¤© | 1.5 å¤© | +é€Ÿç‡é™åˆ¶å¤„ç†, +æµ‹è¯• |
| Phase 2 | 1 å¤© | 2.5 å¤© | +ç®—æ³•å®ç°, +å•å…ƒæµ‹è¯• |
| Phase 3 | 0.5 å¤© | 1 å¤© | +å‘åå…¼å®¹éªŒè¯ |
| Phase 4 | 2-3 å¤© | 4 å¤© | +å¤±è´¥å›é€€, +GraphQL é”™è¯¯å¤„ç† |
| **æ€»è®¡** | **4.5 å¤©** | **9 å¤©** | - |

#### é—æ¼çš„å…³é”®è€ƒè™‘

1. **é€Ÿç‡é™åˆ¶**
   - `getAllActivity()` è·å– 10000 æ¡éœ€è¦ 20 æ¬¡ API è°ƒç”¨
   - éœ€è¦æŒ‡æ•°é€€é¿å’Œ 429 é”™è¯¯å¤„ç†

2. **ç¼“å­˜ç­–ç•¥**
   - å½“å‰ `getPositions()` å’Œ `getActivity()` æ²¡æœ‰ç¼“å­˜
   - æ—¶é—´å‚æ•°éœ€è¦çº³å…¥ç¼“å­˜ key

3. **å†…å­˜æ¶ˆè€—**
   - 10000 æ¡è®°å½•çº¦ 2-5MB
   - è€ƒè™‘æµå¼è¿”å›

4. **æµ‹è¯•è¦†ç›–**
   - `wallet-service.ts` æ— å•å…ƒæµ‹è¯•
   - æ–°æœåŠ¡éœ€è¦å®Œæ•´æµ‹è¯•å¥—ä»¶

5. **åœ°å€æ ‡å‡†åŒ–**
   - ç”¨æˆ·å¯èƒ½æä¾›ä¸»é’±åŒ…è€Œéä»£ç†é’±åŒ…
   - éœ€è¦åœ°å€è§£æå±‚

#### å¹¶è¡ŒåŒ–æœºä¼š

```
Phase 1 (DataApi) â”€â”€â†’ Phase 2 (Analytics) â”€â”€â†’ Phase 3 (MCP)
         â†“
Phase 4 (Subgraph) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ (å¯å¹¶è¡Œå¼€å‘)
```

---

### A.4 ä¿®è®¢åçš„ä¼˜å…ˆçº§

åŸºäº Review åé¦ˆï¼Œæ›´æ–°å®ç°ä¼˜å…ˆçº§ï¼š

| ä¼˜å…ˆçº§ | ä»»åŠ¡ | ä¿®æ­£å·¥ä½œé‡ |
|--------|------|------------|
| **P0** | Activity/Positions å‚æ•°å¢å¼º | 1.5 å¤© |
| **P0** | **æ–°å¢ TradesQueryParams** | 0.5 å¤© |
| **P1** | TraderAnalyticsService | 2.5 å¤© |
| **P1** | MCP å·¥å…·å¢å¼º | 1 å¤© |
| **P1** | æ—¶é—´æˆ³ç±»å‹æ ‡å‡†åŒ– | 0.5 å¤© |
| **P2** | Value/Holders ç«¯ç‚¹ | 1 å¤© |
| **P2** | Subgraph é›†æˆ | 4 å¤© |

**æ€»è®¡**: 11 å¤©ï¼ˆå«æµ‹è¯•å’Œæ–‡æ¡£ï¼‰

---

## é™„å½• B: å‚è€ƒèµ„æ–™

- [Polymarket Data API Activity](https://docs.polymarket.com/developers/misc-endpoints/data-api-activity)
- [Polymarket Data API Positions](https://docs.polymarket.com/developers/misc-endpoints/data-api-get-positions)
- [Polymarket Subgraphs Guide](https://www.polytrackhq.app/blog/polymarket-graphql-subgraph-guide)
- [Goldsky Subgraph Endpoints](https://api.goldsky.com/api/public/project_cl6mb9gxh8qgh01wd0x5xgkb8/subgraphs/)
